# Global API settings
newsapi:
  api_key: ""
  language: "en"

mediastack:
  access_key: ""
  base_url: "http://api.mediastack.com/v1/news"
  delay: 60

openai:
  api_key: ""
  model: "gpt-4"  # Default model if task-specific model not specified
  # Task-specific models
  classify_leadership_model: "gpt-3.5-turbo"
  short_summary_model: "gpt-3.5-turbo"
  clean_article_model: "gpt-3.5-turbo"
  clean_summary_model: "gpt-4"
  spin_genders_model: "gpt-4"
  add_background_on_women_model: "gpt-4"
  max_tokens: 16000
  temperature: 0.1
# Apparently max tokens is 16385 but we're approximating at 4 chars per token so we'll dial it down to 16000

# For a faster linux machine with NVIDIA GPU
#ollama:
#  enabled: True  # Set to True to use Ollama instead of OpenAI
#  #base_url: "http://brooks.office.hbaspecto.com:11434"  # Default Ollama API endpoint
#  model: "llama3.1:8b-instruct-q4_0"  # Default model if task-specific model not specified
#  # Task-specific models
#  clean_article_model: "llama3.1:8b-instruct-q4_0"
#  short_summary_model: "qwen2.5:7b"
#  clean_summary_model: "llama3.1:8b-instruct-q4_0"
#  add_background_on_women_model: "milkey/GLM-4-9B-0414:Q4_K_M"
#  classification_model: "llama3.1:8b"
#  spin_genders_model: "interstellarninja/hermes-2-pro-llama-3-8b:latest"

ollama:
  enabled: True  # Set to True to use Ollama instead of OpenAI
  #base_url: "http://brooks.office.hbaspecto.com:11434"  # Default Ollama API endpoint
  base_url: "http://localhost:11434"  # Default Ollama API endpoint
  model: "llama3.1:8b-instruct-q4_K_M"  # Default model if task-specific model not specified
  # Task-specific models
  clean_article_model: "llama3.1:8b-instruct-q4_K_M"
  short_summary_model: "llama3.1:8b-instruct-q4_K_M"
  clean_summary_model: "llama3.1:8b-instruct-q4_K_M"  # or llama3.1:8b
  add_background_on_women_model: "llama3.1:8b-instruct-q4_K_M"
  classification_model: "llama3.1:8b-instruct-q4_K_M"
  spin_genders_model: "interstellarninja/hermes-2-pro-llama-3-8b:latest"

  # fallback models
  spin_genders_fallback: "dolphin3:latest"
  summary_fallback: "qwen2.5:7b"
  temperature: 0.1
  max_tokens: 8192  # Maximum tokens for completion

# DEPRECATED: localai is deprecated in favor of Ollama for local LLM inference
# localai:
#   "enabled": False
#   "min_ram": 16
#   "min_cores": 8
#   "max_input_tokens": 2048
#   "local_model": "Zyphra/Zamba2-2.7B-instruct"
#   "cpu_model_name": "Zyphra/Zamba2-2.7B-instruct"
#   "local_model_path": "models/Zyphra"
#   "max_memory_mps": "6GB"
#   "max_memory_cpu": "58GB"

local_summarization:
    "enabled": True
    "model": "facebook/bart-large-cnn"

# The number of images to get from the news source to look for women.
max_images: 3

# Image sizing configuration for HTML output
image_sizes:
  female_base: 400          # Base size for images with female faces
  no_face_base: 200         # Base size for images with no faces
  other_base: 150           # Base size for other images (male or low confidence)
  leader_multiplier: 2      # Multiply image size by this for female_leader articles

# Control how female leadership is identified
female_leadership_detection:
  use_local_checks: True  # If True, check for female names and leadership keywords before calling LLM
  require_female_names: True  # Only call LLM if female names are detected
  require_leadership_keywords: False  # Only call LLM if leadership keywords are detected


# Prompts for OpenAI
prompts:
  clean_article: >-
    Below is a news article copied from an online news source.

    Return the article *exactly as written* except for the following removals:
    - ads
    - subscription prompts
    - paywall text
    - navigation lists
    - “related stories” or “story continues below”
    - promotional blocks
    - social media prompts
    - newsletter signups
    - cookie notices
    - photo captions not part of the narrative
    - any boilerplate not part of the article's main text

    Rules:
    - Do NOT rephrase, summarize, explain, or add commentary.
    - Do NOT add any introduction, explanation, or lead-in.
    - Output *only* the cleaned article text.
    - Begin your output with the first word of the cleaned article.

    ARTICLE:

  classification: >-
    You are a classifier.

    Task:
    Read the article.
    Determine whether the article includes at least one WOMAN in a genuine leadership role.

    Rules:
    - If you find at least one woman in a leadership role, answer exactly:
      yes [Full Name]
      (Example: yes Jane Smith)
    - If you do not, answer exactly:
      no

    Do not add any extra words.

    Article:

  short_summary: >-
    Summarize the article snippet in exactly two sentences.

    Output format:
    <Sentence 1> <Sentence 2>

    Do NOT add anything before, after, or between the two sentences.

    No preamble. No labels. No commentary.

    Article:

  spin_genders: >-
    You will transform the following news article. The transformation must
    preserve all facts exactly as written.

    Before you begin, read these rules carefully:

    NON-NEGOTIABLE FACT RULES:
    1. Do NOT change any gender, sex, family role, or identity.
    2. Do NOT change who was injured, who died, who survived, or who performed any action.
    3. Do NOT change the sequence of events, the causal relations, or the results.
    4. Do NOT change or paraphrase any quotes.
    5. Do NOT insert new events, new actions, new motives, or new participants.

    TRANSFORMATION RULES:
    6. Apply a mild feminist reframing while preserving all facts.
    7. Preserve all full names of women exactly as written.
    8. Preserve all quotes spoken by women exactly.
    9. You may replace non-essential male names with neutral roles such as
       “a spokesperson,” “a city official,” or “a representative.”
    10. If a male name is required for factual accuracy, leave it unchanged.
    11. Do NOT alter male pronouns. They will be handled later.
    12. Keep the length and structure similar to the original.
    13. Do NOT add commentary, biography, ideology, or background.
    14. Do NOT summarize or shorten unless necessary for clarity.

    OUTPUT RULES:
    15. Output only the transformed article.
    16. Do NOT add any introduction, explanation, commentary, or section headings.

    ARTICLE:

  add_background_on_women: >-
    Insert one brief, accurate, widely known background sentence immediately after the first mention of each woman in the article, but only if she is a public figure.

    Public figures include:
    - elected officials
    - political candidates
    - public servants
    - journalists
    - activists
    - celebrities
    - senior academics
    - widely recognized professionals

    Rules:
    - Add background ONLY for women.
    - Do NOT add or restore information about men.
    - Do NOT change wording, facts, quotes, or structure.
    - Do NOT add any explanation of what you are doing.
    - Output only the modified article.
    - Begin your output with the first word of the revised article.

    ARTICLE:


  clean_summary: |
    Create a cleaner, tighter version of the article below.

    The input article has already been cleaned of ads and boilerplate.

    Two modes:
    1. If the article is a normal news report with real facts, real people, and real quotes:
       - Preserve all quotes exactly.
       - Preserve all names and factual details.
       - Keep the structure the same.
       - Only tighten wording and reduce redundancy.

    2. If the article is obviously promotional, repetitive, low-information,
       or not a legitimate news report (e.g., SEO spam about casinos,
       investments, crypto, miracle cures, or generic lifestyle advice):
       - Remove repetitive filler and marketing fluff.
       - Preserve only concrete factual statements, if any.
       - Produce a concise, factual summary under 500 words.

    General rules:
    • Emphasize the contributions of women when they appear.
    • Do not add new facts or interpretations.
    • Do not fabricate quotes or names.
    • Do not add commentary, headings, or markdown.
    • Final output must be under 500 words.
    • Begin the output with the first word of the rewritten article.

    ARTICLE:

# Global defaults
default_summarize_selected: true   # apply clean_summary to all female_leader articles unless overridden

genderize:
  api_url: "https://api.genderize.io"

leadership_keywords:
  - CEO
  - president
  - minister
  - chair
  - director
  - founder
  - co-founder
  - leader
  - head
  - manager
  - executive
  - officer
  - principal
  - captain
  - commander
  - chief
  - boss
  - forewoman
  - foreman
  - superintendent
  - overseer
  - mayor
  - governor
  - chancellor
  - senator
  - representative
  - ambassador
  - diplomat
  - judge
  - magistrate
  - commissioner
  - candidate
  - nominee
  - appointee
  - official
  - supervisor
  - coordinator
  - facilitator
  - organizer
  - partner
  - co-chair
  - provost
  - rector
  - headmistress
  - premier
  - minister
  - sheriff
  - chairman
  - chairwoman
  - treasurer
  - chairperson
  - trustee
  - councillor
  - advisor
  - coach
  - mediator

# Define as many queries as you like:
#   - `q`: your NewsAPI query (supports quoted phrases, +/– prefixes, AND/OR/NOT)
#   - `classification`: whether to apply the female-leadership filter
#   - `fallback`: what to do with non-female-leadership articles
#       * show_full: include original
#       * short_summary: replace content with OpenAI summary
#       * spin_genders: rewrite via OpenAI with female spin
#       * exclude: drop it
queries:

  - name: Calgary
    provider: newsapi
    q: "Calgary"
    page_size: 10
    classification: false
    fallback_image_female: spin_genders
    fallback: short_summary  # Options: show_full, short_summary, spin
    fallback_women: spin_genders
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true

  - name: Canada
    provider: mediastack
    q: "Canada,-investing,-investment,-share,-market capitalization,-earnings per share,-shares,-stock,-business.-wall street,-stock market,-stocks,-strong-buy,-finance,-earnings,-price target,-target price,-www.americanbankingnews.com,-banking"
    categories: "-business"  # exclude business news, really we want to exclude share purchases and stock market news
    page_size: 35
    classification: true
    languages: en
    sources: "-americanbankingnews"
    fallback: short_summary  # Options: show_full, short_summary, spin_genders, exclude
    fallback_women: spin_genders # If a woman is mentioned in the article, use this fallback
    summarize_selected: true
    fallback_image_female: short_summary     # if a woman’s face is prominent
    male_initials: true
    remove_male_pronouns: true
#    countries: ca doesn't work
#    history_days: 5       History seems to not work at least not the way we're doing it with the free API tier.

  - name: Global News
    provider: newsapi
    q: 'Global News'
    page_size: 100
    history_days: 5       # override default: grab the last 14 days
    classification: true
    fallback: exclude  # Options: show_full, short_summary, spin_genders, exclude
    fallback_image_female: short_summary     # if a woman’s face is prominent
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true

  - name: Canada Women
    provider: newsapi
    q: '"Canada" and ("woman" or "women" or "girl")'
    page_size: 20
    classification: true
    fallback: spin_genders  # Options: show_full, short_summary, spin_genders, exclude
    fallback_image_female: spin_genders     # if a woman’s face is prominent
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true

  - name: Skiing
    provider: newsapi
    q: '"Skiing"'
    page_size: 25
    classification: true
    fallback: short_summary  # Options: show_full, short_summary, spin_genders, exclude
    fallback_women: spin_genders
    fallback_image_female: show_full     # if a woman’s face is prominent
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true

  - name: Trombone
    provider: newsapi
    q: '"Trombone"'
    page_size: 20
    classification: true
    fallback: short_summary  # Options: show_full, short_summary, spin_genders, exclude
    fallback_women: spin_genders
    fallback_image_female: show_full     # if a woman’s face is prominent
    summarize_selected: true
    male_initials: false
    remove_male_pronouns: false
