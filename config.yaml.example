# Global API settings
newsapi:
  api_key: ""
  language: "en"

mediastack:
  access_key: ""
  base_url: "http://api.mediastack.com/v1/news"
  delay: 60

openai:
  api_key: ""
  model: "gpt-4"  # Default model if task-specific model not specified
  # Task-specific models
  classify_leadership_model: "gpt-3.5-turbo"
  short_summary_model: "gpt-3.5-turbo"
  clean_article_model: "gpt-3.5-turbo"
  clean_summary_model: "gpt-4"
  spin_genders_model: "gpt-4"
  add_background_on_women_model: "gpt-4"
  max_tokens: 16000
  temperature: 0.1
# Apparently max tokens is 16385 but we're approximating at 4 chars per token so we'll dial it down to 16000

ollama:
  enabled: True  # Set to True to use Ollama instead of OpenAI
  base_url: "http://localhost:11434"  # Default Ollama API endpoint
  model: "llama3.1:8b"  # Default model if task-specific model not specified
  # Task-specific models
  clean_article_model: "milkey/GLM-4-9B-0414:Q4_K_M"
  short_summary_model: "milkey/GLM-4-9B-0414:Q4_K_M"
  clean_summary_model: "milkey/GLM-4-9B-0414:Q4_K_M"
  add_background_on_women_model: "milkey/GLM-4-9B-0414:Q4_K_M"

  classification_model: "llama3.1:8b"

  spin_genders_model: "interstellarninja/hermes-2-pro-llama-3-8b:latest"

  # fallback models
  spin_genders_fallback: "dolphin3:latest"
  summary_fallback: "qwen2.5:7b"
  temperature: 0.1
  max_tokens: 8192  # Maximum tokens for completion

# DEPRECATED: localai is deprecated in favor of Ollama for local LLM inference
# localai:
#   "enabled": False
#   "min_ram": 16
#   "min_cores": 8
#   "max_input_tokens": 2048
#   "local_model": "Zyphra/Zamba2-2.7B-instruct"
#   "cpu_model_name": "Zyphra/Zamba2-2.7B-instruct"
#   "local_model_path": "models/Zyphra"
#   "max_memory_mps": "6GB"
#   "max_memory_cpu": "58GB"

local_summarization:
    "enabled": True
    "model": "facebook/bart-large-cnn"

# The number of images to get from the news source to look for women.
max_images: 3

# Control how female leadership is identified
female_leadership_detection:
  use_local_checks: True  # If True, check for female names and leadership keywords before calling LLM
  require_female_names: True  # Only call LLM if female names are detected
  require_leadership_keywords: False  # Only call LLM if leadership keywords are detected


# Prompts for OpenAI
prompts:
  clean_article: >-
    Below is a news article copied from an online news source.

    Your task:
    Return the article **exactly as written**, except:

    - Remove ads
    - Remove subscription prompts
    - Remove paywall text
    - Remove navigation lists
    - Remove “related stories” or “story continues below”
    - Remove promotional blocks
    - Remove social media prompts
    - Remove newsletter signup boxes
    - Remove cookie notices
    - Remove photo captions if they are not part of the story
    - Remove any other boilerplate or distractions that are not part of the article’s narrative

    Important rules:
    - Do NOT rephrase or rewrite any remaining text.
    - Do NOT summarize or shorten the meaningful content.
    - Do NOT add new sentences or commentary.
    - Do NOT remove any quotes, names, or factual content from the main article.
    - Preserve paragraph breaks where possible.
    - If uncertain whether a section is article content or boilerplate, KEEP IT.

    Now return the cleaned article only:

    ARTICLE:

  classification: >-
    You are a classifier.

    Task:
    Read the article.
    Determine whether the article includes at least one WOMAN in a genuine leadership role.

    Rules:
    - If you find at least one woman in a leadership role, answer exactly:
      yes [Full Name]
      (Example: yes Jane Smith)
    - If you do not, answer exactly:
      no

    Do not add any extra words.

    Article:

  short_summary: >-
    Summarize the article snippet in exactly two sentences.

    Output format:
    <Sentence 1> <Sentence 2>

    Do NOT add anything before, after, or between the two sentences.

    No preamble. No labels. No commentary.

    Article:

  spin_genders: >-
    Rewrite the following news article with a *mild feminist reframing*, while keeping all facts, events, names, quotes, and meaning intact.

    Rules:

    1. Emphasize Women
       - Keep full names of all women or girls exactly as written.
       - Preserve all quotes spoken by women exactly as written.
       - Lightly strengthen their presence, focus, or perceived agency (without inventing new actions, claims, or events).

    2. De-Emphasize Men
       - If a male figure is *not essential* to the meaning, replace his entire name with a neutral role (e.g., “a spokesperson,” “a city official,” “a representative”).
       - If a male public figure’s name *must* remain for factual accuracy, leave the full name unchanged. Do NOT convert it to initials here. (A later process will handle this.)
       - Do NOT change, rewrite, or remove any masculine pronouns. (This will be handled later by another process.)
       - Do NOT modify any quotes spoken by men.

    3. Constraints
       - Do NOT add background information about anyone.
       - Do NOT remove or alter factual content.
       - Keep the length, tone, and structure similar to the original.
       - Do NOT add commentary, disclaimers, or explanations.

    4. Output
       - Produce only the rewritten article text.

    Now rewrite the article:

    Original article:

  add_background_on_women: >-

    Your task is to insert a brief, factual background sentence after the first mention of each woman in the article, but only if she is a public figure.

    Follow these rules precisely:

    1. Identify Women
       - Identify all named women or girls mentioned in the article.
       - For each one, decide whether she is a public figure.
       - Public figures include: elected officials, political candidates, public servants, journalists, activists, celebrities, senior academics, or widely known professionals.

    2. Insert Background (Women Only)
       - For each woman who is a public figure, insert exactly ONE sentence of widely known, factual background.
       - Insert the sentence immediately after the woman’s first appearance.
       - The sentence must be factual, concise, and reflect information that is broadly known or easily verifiable.

    3. Do NOT Modify Content
       - Do NOT change any wording in the original article.
       - Do NOT remove or rewrite any part of the article.
       - Do NOT add background information about men.
       - Do NOT reorder or merge paragraphs.
       - Do NOT add commentary, explanations, or analysis.

    4. Output Formatting
       - Return the full article with the inserted background sentences in place.
       - Do not add headers, labels, or notes.
       - Do not preface with explanations.

    Article:

# Global defaults
default_summarize_selected: true   # apply clean_summary to all female_leader articles unless overridden

genderize:
  api_url: "https://api.genderize.io"

leadership_keywords:
  - CEO
  - president
  - minister
  - chair
  - director
  - founder
  - co-founder
  - leader
  - head
  - manager
  - executive
  - officer
  - principal
  - captain
  - commander
  - chief
  - boss
  - forewoman
  - foreman
  - superintendent
  - overseer
  - mayor
  - governor
  - chancellor
  - senator
  - representative
  - ambassador
  - diplomat
  - judge
  - magistrate
  - commissioner
  - candidate
  - nominee
  - appointee
  - official
  - supervisor
  - coordinator
  - facilitator
  - organizer
  - partner
  - co-chair
  - provost
  - rector
  - headmistress
  - premier
  - minister
  - sheriff
  - chairman
  - chairwoman
  - treasurer
  - chairperson
  - trustee
  - councillor
  - advisor
  - coach
  - mediator

# Define as many queries as you like:
#   - `q`: your NewsAPI query (supports quoted phrases, +/– prefixes, AND/OR/NOT)
#   - `classification`: whether to apply the female-leadership filter
#   - `fallback`: what to do with non-female-leadership articles
#       * show_full: include original
#       * short_summary: replace content with OpenAI summary
#       * spin_genders: rewrite via OpenAI with female spin
#       * exclude: drop it
queries:

  - name: Calgary
    provider: newsapi
    q: "Calgary"
    page_size: 10
    classification: false
    fallback_image_female: spin_genders
    fallback: short_summary  # Options: show_full, short_summary, spin
    fallback_women: spin_genders
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true

  - name: Canada
    provider: mediastack
    q: "Canada,-investing,-investment,-share,-market capitalization,-earnings per share,-shares,-stock,-business.-wall street,-stock market,-stocks,-strong-buy,-finance,-earnings,-price target,-target price,-www.americanbankingnews.com,-banking"
    categories: "-business"  # exclude business news, really we want to exclude share purchases and stock market news
    page_size: 35
    classification: true
    languages: en
    sources: "-americanbankingnews"
    fallback: short_summary  # Options: show_full, short_summary, spin_genders, exclude
    fallback_women: spin_genders # If a woman is mentioned in the article, use this fallback
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true
#    countries: ca doesn't work
#    history_days: 5       History seems to not work at least not the way we're doing it with the free API tier.

  - name: Global News
    provider: newsapi
    q: 'Global News'
    page_size: 100
    history_days: 5       # override default: grab the last 14 days
    classification: true
    fallback: exclude  # Options: show_full, short_summary, spin_genders, exclude
    fallback_image_female: short_summary     # if a woman’s face is prominent
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true

  - name: Canada Women
    provider: newsapi
    q: '"Canada" and ("woman" or "women" or "girl")'
    page_size: 20
    classification: true
    fallback: exclude  # Options: show_full, short_summary, spin_genders, exclude
    fallback_image_female: short_summary     # if a woman’s face is prominent
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true

  - name: Skiing
    provider: newsapi
    q: '"Skiing"'
    page_size: 25
    classification: true
    fallback: short_summary  # Options: show_full, short_summary, spin_genders, exclude
    fallback_women: spin_genders
    fallback_image_female: show_full     # if a woman’s face is prominent
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true

  - name: Trombone
    provider: newsapi
    q: '"Trombone"'
    page_size: 20
    classification: true
    fallback: short_summary  # Options: show_full, short_summary, spin_genders, exclude
    fallback_women: spin_genders
    fallback_image_female: show_full     # if a woman’s face is prominent
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true
