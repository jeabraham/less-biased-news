# Global API settings
newsapi:
  api_key: ""
  language: "en"

mediastack:
  access_key: ""
  base_url: "http://api.mediastack.com/v1/news"
  delay: 60

openai:
  api_key: ""
  model: "gpt-4"  # Default model if task-specific model not specified
  # Task-specific models
  classify_leadership_model: "gpt-3.5-turbo"
  short_summary_model: "gpt-3.5-turbo"
  clean_summary_model: "gpt-4"
  spin_genders_model: "gpt-4"
  add_background_on_women_model: "gpt-4"
  max_tokens: 16000
  temperature: 0.1
# Apparently max tokens is 16385 but we're approximating at 4 chars per token so we'll dial it down to 16000

ollama:
  enabled: True  # Set to True to use Ollama instead of OpenAI
  base_url: "http://localhost:11434"  # Default Ollama API endpoint
  model: "llama3-lexi-uncensored"  # Default model if task-specific model not specified
  # Task-specific models
  classify_leadership_model: " llama3.1:8b"
  short_summary_model: "llama3.1:8b"
  clean_summary_model: "llama3.1:8b"
  spin_genders_model: "dolphin3"
  add_background_on_women_model: "llama3.1:8b"
  temperature: 0.1
  max_tokens: 4096  # Maximum tokens for completion

# DEPRECATED: localai is deprecated in favor of Ollama for local LLM inference
# localai:
#   "enabled": False
#   "min_ram": 16
#   "min_cores": 8
#   "max_input_tokens": 2048
#   "local_model": "Zyphra/Zamba2-2.7B-instruct"
#   "cpu_model_name": "Zyphra/Zamba2-2.7B-instruct"
#   "local_model_path": "models/Zyphra"
#   "max_memory_mps": "6GB"
#   "max_memory_cpu": "58GB"

local_summarization:
    "enabled": True
    "model": "facebook/bart-large-cnn"

# The number of images to get from the news source to look for women.
max_images: 3

# Control how female leadership is identified
female_leadership_detection:
  use_local_checks: True  # If True, check for female names and leadership keywords before calling LLM
  require_female_names: True  # Only call LLM if female names are detected
  require_leadership_keywords: True  # Only call LLM if leadership keywords are detected


# Prompts for OpenAI
prompts:
  clean_article: >-
    Below is a news article copied from an online news source.

    Your task:
    Return the article **exactly as written**, except:

    - Remove ads
    - Remove subscription prompts
    - Remove paywall text
    - Remove navigation lists
    - Remove “related stories” or “story continues below”
    - Remove promotional blocks
    - Remove social media prompts
    - Remove newsletter signup boxes
    - Remove cookie notices
    - Remove photo captions if they are not part of the story
    - Remove any other boilerplate or distractions that are not part of the article’s narrative

    Important rules:
    - Do NOT rephrase or rewrite any remaining text.
    - Do NOT summarize or shorten the meaningful content.
    - Do NOT add new sentences or commentary.
    - Do NOT remove any quotes, names, or factual content from the main article.
    - Preserve paragraph breaks where possible.
    - If uncertain whether a section is article content or boilerplate, KEEP IT.

    Now return the cleaned article only:

    ARTICLE:

  classification: >-
    You are a classifier.

    Task:
    Read the article.
    Determine whether the article includes at least one WOMAN in a genuine leadership role.

    Rules:
    - If you find at least one woman in a leadership role, answer exactly:
      yes [Full Name]
      (Example: yes Jane Smith)
    - If you do not, answer exactly:
      no

    Do not add any extra words.

    Article:

  short_summary: >-
    Summarize the following article snippet in two sentences:
  spin_genders: >-
    You are rewriting a news article with a mild feminist reframing. Your goal is to adjust emphasis and tone, while preserving the original meaning, facts, and structure.

    Follow these rules:

    1. **Emphasize Women**
       - Preserve the full names of all women or girls mentioned.
       - If a woman is quoted, keep her full quote intact.
       - Strengthen her presence: expand her role slightly, amplify her agency, and give her actions a touch more importance.
       - Do not invent new events or alter factual information.

    2. **De-Emphasize Men**
       - If a man is mentioned and his name is not essential to the meaning, replace his name with a neutral phrase such as “a spokesperson,” “an official,” “a representative,” or “a city staff member.”
       - Remove masculine pronouns when possible without harming clarity.
       - If a man’s name must stay (e.g., key public figure), keep the surname, replace any first name with an initial, and reduce descriptive detail and avoid adding any background about him.

    3. **Tone & Meaning**
       - Maintain journalistic clarity and neutrality.
       - Keep all facts intact.
       - The feminist reframing should be gentle, subtle, and grounded — not ideological or exaggerated.

    4. **Do NOT add biographical background in this stage.**
       - That will be handled later.

    5. **Length**
       - Keep the length similar to the original unless the original is extremely short.

    Now rewrite the following article under these rules:

    —
    **Original article:**

  add_background_on_women: >-
    Your task is to add accurate, commonly known background information about women who appear in this article, but only if they are public figures.

    Follow these rules carefully:

    1. **Identify Women**
       - Identify all named women or girls in the article.
       - Determine if each one is a public figure, such as:
         • elected official
         • political candidate
         • public servant
         • journalist
         • activist
         • celebrity
         • senior academic
         • other widely known professional roles

    2. **Add Background (Women Only)**
       - For each woman who is a public figure, add a **brief, factual, one-sentence background** immediately after her first mention.
       - This sentence must reflect widely known public information only.
       - Do not create fictional details or speculation.

    3. **Do NOT Add Background About Men**
       - Men should remain anonymized or de-emphasized exactly as written in the Stage 1 version.
       - Do not restore male names that were removed.

    4. **Preserve Meaning**
       - Do not change the article’s events, quotes, or narrative flow.
       - Only insert factual background sentences about women.

    5. **Keep It Subtle**
       - Tone should remain journalistic and neutral.

    Now take the following Stage 1 rewritten article and perform only the additions described above:

  clean_summary: >-
    Please create new version of the following article, removing ads, subscription
    prompts, boilerplate text, and distractions. It should be slightly shorter than the original, and no longer than 500 words.
    Ensure you include the core narrative, and the quotes and contributions of women, especially <leader_name>.
    ###

# Global defaults
default_summarize_selected: true   # apply clean_summary to all female_leader articles unless overridden

genderize:
  api_url: "https://api.genderize.io"

leadership_keywords:
  - CEO
  - president
  - minister
  - chair
  - director
  - founder
  - co-founder
  - leader
  - head
  - manager
  - executive
  - officer
  - principal
  - captain
  - commander
  - chief
  - boss
  - forewoman
  - foreman
  - superintendent
  - overseer
  - mayor
  - governor
  - chancellor
  - senator
  - representative
  - ambassador
  - diplomat
  - judge
  - magistrate
  - commissioner
  - candidate
  - nominee
  - appointee
  - official
  - supervisor
  - coordinator
  - facilitator
  - organizer
  - partner
  - co-chair
  - provost
  - rector
  - headmistress
  - premier
  - minister
  - sheriff
  - chairman
  - chairwoman
  - treasurer
  - chairperson
  - trustee
  - councillor
  - advisor
  - coach
  - mediator

# Define as many queries as you like:
#   - `q`: your NewsAPI query (supports quoted phrases, +/– prefixes, AND/OR/NOT)
#   - `classification`: whether to apply the female-leadership filter
#   - `fallback`: what to do with non-female-leadership articles
#       * show_full: include original
#       * short_summary: replace content with OpenAI summary
#       * spin_genders: rewrite via OpenAI with female spin
#       * exclude: drop it
queries:

  - name: Calgary
    provider: newsapi
    q: "Calgary"
    page_size: 10
    classification: false
    fallback_image_female: spin_genders
    fallback: short_summary  # Options: show_full, short_summary, spin
    fallback_women: spin_genders
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true

  - name: Canada
    provider: mediastack
    q: "Canada,-investing,-investment,-share,-market capitalization,-earnings per share,-shares,-stock,-business.-wall street,-stock market,-stocks,-strong-buy,-finance,-earnings,-price target,-target price,-www.americanbankingnews.com,-banking"
    categories: "-business"  # exclude business news, really we want to exclude share purchases and stock market news
    page_size: 35
    classification: true
    languages: en
    sources: "-americanbankingnews"
    fallback: short_summary  # Options: show_full, short_summary, spin_genders, exclude
    fallback_women: spin_genders # If a woman is mentioned in the article, use this fallback
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true
#    countries: ca doesn't work
#    history_days: 5       History seems to not work at least not the way we're doing it with the free API tier.

  - name: Global News
    provider: newsapi
    q: 'Global News'
    page_size: 100
    history_days: 5       # override default: grab the last 14 days
    classification: true
    fallback: exclude  # Options: show_full, short_summary, spin_genders, exclude
    fallback_image_female: short_summary     # if a woman’s face is prominent
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true

  - name: Canada Women
    provider: newsapi
    q: '"Canada" and ("woman" or "women" or "girl")'
    page_size: 20
    classification: true
    fallback: exclude  # Options: show_full, short_summary, spin_genders, exclude
    fallback_image_female: short_summary     # if a woman’s face is prominent
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true

  - name: Skiing
    provider: newsapi
    q: '"Skiing"'
    page_size: 25
    classification: true
    fallback: short_summary  # Options: show_full, short_summary, spin_genders, exclude
    fallback_women: spin_genders
    fallback_image_female: show_full     # if a woman’s face is prominent
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true

  - name: Trombone
    provider: newsapi
    q: '"Trombone"'
    page_size: 20
    classification: true
    fallback: short_summary  # Options: show_full, short_summary, spin_genders, exclude
    fallback_women: spin_genders
    fallback_image_female: show_full     # if a woman’s face is prominent
    summarize_selected: true
    male_initials: true
    remove_male_pronouns: true
